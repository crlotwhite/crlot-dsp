

load("@rules_cc//cc:defs.bzl", "cc_library")
load("@rules_foreign_cc//foreign_cc:defs.bzl", "cmake")

cc_library(
    name = "dr_libs",
    hdrs = glob(["dr_libs/**/*.h"]),
    includes = ["dr_libs"],
    visibility = ["//visibility:public"],
)

cmake(
    name = "kissfft",
    lib_source = "@kissfft_src//:all_srcs",
    cache_entries = {
        "KISSFFT_STATIC": "ON",
        "KISSFFT_TEST": "OFF",
        "KISSFFT_TOOLS": "OFF",
        "KISSFFT_DATATYPE": "float",  # double/int16_t 등도 가능
        "KISSFFT_OPENMP": "OFF",      # macOS/clang이면 보통 OFF 유지
    },
    targets = ["install"],
    out_static_libs = select({
        "@@platforms//os:windows": ["kissfft-float.lib"],
        "//conditions:default":   ["libkissfft-float.a"],
    }),
    # kissfft CMake가 보통 include/<...>로 설치하므로 include 루트를 노출
    includes = ["include"],  # 필요시 ["include/kissfft"]로 세분화
    visibility = ["//visibility:public"],
)